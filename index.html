<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1E293B">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="DropLit">
  <meta name="application-name" content="DropLit">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="description" content="DropLit ‚Äî Voice-first idea capture app.">
  <title>DropLit</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-primary: #FF6B4A;
      --color-primary-dark: #E85A3A;
      --color-primary-light: #FF8A70;
      --color-recording: #EF4444;
      --color-success: #10B981;
      --color-warning: #F59E0B;
      --color-error: #EF4444;
      --color-bg: #FAFAF9;
      --color-bg-card: #FFFFFF;
      --color-bg-soft: #EEEEED;
      --color-text: #1E293B;
      --color-text-soft: #475569;
      --color-text-muted: #64748B;
      --color-border: #E2E8F0;
      --color-active: #FF6B4A;
      --cat-tasks-bg: #FEF3C7; --cat-tasks-text: #92400E;
      --cat-ideas-bg: #E0E7FF; --cat-ideas-text: #3730A3;
      --cat-handmagic-bg: #FCE7F3; --cat-handmagic-text: #9D174D;
      --cat-design-bg: #D1FAE5; --cat-design-text: #065F46;
      --cat-bugs-bg: #FEE2E2; --cat-bugs-text: #991B1B;
      --cat-questions-bg: #E0F2FE; --cat-questions-text: #075985;
      --cat-inbox-bg: #F1F5F9; --cat-inbox-text: #475569;
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --radius-md: 12px;
      --radius-full: 9999px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; overflow: hidden; touch-action: manipulation; }
    body { font-family: var(--font-main); background: var(--color-bg); color: var(--color-text); -webkit-font-smoothing: antialiased; padding-top: var(--safe-top); }
    .app { display: flex; flex-direction: column; height: 100vh; height: 100dvh; max-width: 480px; margin: 0 auto; background: var(--color-bg); }

    .header { display: flex; align-items: center; padding: 8px 12px; background: var(--color-bg-card); border-bottom: 1px solid var(--color-border); gap: 10px; }
    .logo-btn { width: 38px; height: 38px; border: none; background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light)); border-radius: var(--radius-full); cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 2px 6px rgba(255,107,74,0.3); }
    .logo-btn:active { transform: scale(0.95); }
    .logo-btn svg { width: 20px; height: 20px; }
    .slogan { flex: 1; font-size: 0.75rem; font-weight: 700; color: var(--color-text); text-align: center; text-transform: uppercase; letter-spacing: 0.02em; }
    .slogan-hl { color: var(--color-primary); }
    .btn-icon { width: 38px; height: 38px; border: none; background: var(--color-bg-soft); border-radius: var(--radius-full); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--color-text-soft); flex-shrink: 0; }
    .btn-icon:active { transform: scale(0.95); }

    .network-banner { display: none; padding: 6px; background: var(--color-error); color: white; font-size: 0.7rem; font-weight: 600; text-align: center; }
    .network-banner.show { display: block; }
    .warning { padding: 8px; background: #FEF3C7; color: #92400E; font-size: 0.75rem; text-align: center; font-weight: 600; display: none; }

    .filters { background: var(--color-bg-card); border-bottom: 1px solid var(--color-border); padding: 8px 10px; }
    .time-row { display: flex; justify-content: center; gap: 6px; margin-bottom: 8px; }
    .time-btn { height: 34px; padding: 0 12px; border: 2px solid transparent; background: var(--color-bg-soft); border-radius: var(--radius-full); font-family: var(--font-main); font-size: 0.7rem; font-weight: 600; color: var(--color-text-soft); cursor: pointer; text-transform: uppercase; display: flex; align-items: center; gap: 5px; transition: all 0.15s; }
    .time-btn:active { transform: scale(0.97); }
    .time-btn[data-time="all"] { background: var(--color-primary); color: white; border-color: var(--color-primary); }
    .time-btn[data-time="all"] .cnt { background: rgba(255,255,255,0.25); }
    .time-btn:not([data-time="all"]).active { border-color: var(--color-active); background: var(--color-bg-soft); color: var(--color-text); }
    .time-btn:not([data-time="all"]).active .cnt { background: var(--color-active); color: white; }
    .cnt { min-width: 20px; height: 20px; padding: 0 5px; background: rgba(0,0,0,0.08); border-radius: var(--radius-full); font-size: 0.65rem; font-weight: 700; display: inline-flex; align-items: center; justify-content: center; }
    .sort-btn { height: 34px; width: 42px; padding: 0; border: 2px solid transparent; background: var(--color-bg-soft); border-radius: var(--radius-full); font-size: 0.85rem; font-weight: 600; color: var(--color-text-soft); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; }
    .sort-btn:active { transform: scale(0.97); }
    .sort-btn.desc { border-color: var(--color-active); color: var(--color-text); }

    .cat-row { display: flex; align-items: center; gap: 4px; }
    .cat-nav { width: 28px; height: 34px; border: none; background: transparent; cursor: pointer; color: var(--color-text-muted); display: flex; align-items: center; justify-content: center; flex-shrink: 0; border-radius: var(--radius-md); }
    .cat-nav:active { background: var(--color-bg-soft); }
    .cats { display: flex; gap: 6px; overflow-x: auto; flex: 1; scrollbar-width: none; scroll-behavior: smooth; padding: 2px 0; }
    .cats::-webkit-scrollbar { display: none; }
    .cat { flex-shrink: 0; height: 34px; padding: 0 12px; border: 2px solid transparent; border-radius: var(--radius-full); font-family: var(--font-main); font-size: 0.7rem; font-weight: 700; cursor: pointer; text-transform: uppercase; display: flex; align-items: center; gap: 5px; transition: all 0.15s; }
    .cat:active { transform: scale(0.97); }
    .cat.active { border-color: var(--color-active) !important; }
    .cat[data-category="tasks"] { background: var(--cat-tasks-bg); color: var(--cat-tasks-text); }
    .cat[data-category="tasks"] .cnt { background: rgba(146,64,14,0.12); }
    .cat[data-category="ideas"] { background: var(--cat-ideas-bg); color: var(--cat-ideas-text); }
    .cat[data-category="ideas"] .cnt { background: rgba(55,48,163,0.12); }
    .cat[data-category="handmagic"] { background: var(--cat-handmagic-bg); color: var(--cat-handmagic-text); }
    .cat[data-category="handmagic"] .cnt { background: rgba(157,23,77,0.12); }
    .cat[data-category="design"] { background: var(--cat-design-bg); color: var(--cat-design-text); }
    .cat[data-category="design"] .cnt { background: rgba(6,95,70,0.12); }
    .cat[data-category="bugs"] { background: var(--cat-bugs-bg); color: var(--cat-bugs-text); }
    .cat[data-category="bugs"] .cnt { background: rgba(153,27,27,0.12); }
    .cat[data-category="questions"] { background: var(--cat-questions-bg); color: var(--cat-questions-text); }
    .cat[data-category="questions"] .cnt { background: rgba(7,89,133,0.12); }
    .cat[data-category="inbox"] { background: var(--cat-inbox-bg); color: var(--cat-inbox-text); }
    .cat[data-category="inbox"] .cnt { background: rgba(71,85,105,0.12); }
    .cat-add { flex-shrink: 0; width: 34px; height: 34px; border: 2px dashed var(--color-border); border-radius: var(--radius-full); background: transparent; color: var(--color-text-muted); font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .cat-add:active { border-color: var(--color-primary); color: var(--color-primary); }

    .ideas-wrap { flex: 1; overflow-y: auto; padding: 10px 14px 16px; -webkit-overflow-scrolling: touch; position: relative; }
    .ideas { display: flex; flex-direction: column; gap: 10px; }
    .date-sep { display: flex; align-items: center; gap: 10px; padding: 10px 0 4px; font-size: 0.65rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.08em; }
    .date-sep::before, .date-sep::after { content: ''; flex: 1; height: 1px; background: var(--color-border); }

    /* Smart scroll FAB - fixed position relative to ideas-wrap */
    .scroll-fab { position: absolute; right: 20px; width: 44px; height: 44px; border: none; background: var(--color-bg-card); border-radius: var(--radius-full); box-shadow: 0 2px 12px rgba(0,0,0,0.15); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--color-primary); font-size: 1.2rem; opacity: 0; transform: scale(0.8); transition: all 0.2s ease; pointer-events: none; z-index: 20; }
    .scroll-fab.show { opacity: 1; transform: scale(1); pointer-events: auto; }
    .scroll-fab:active { transform: scale(0.9); background: var(--color-bg-soft); }
    .scroll-fab.top { top: 16px; }
    .scroll-fab.bottom { bottom: 16px; }

    /* Card */
    .card { background: var(--color-bg-card); border-radius: var(--radius-md); padding: 12px 14px; box-shadow: var(--shadow-sm); border: 2px solid var(--color-border); cursor: pointer; transition: all 0.15s; }
    .card:active { transform: scale(0.995); }
    .card.active { border-color: var(--color-active); box-shadow: 0 2px 12px rgba(255,107,74,0.15); }
    .card.editing { border-color: var(--color-primary); }
    .card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .card-cat { padding: 4px 10px; border-radius: var(--radius-full); font-size: 0.65rem; font-weight: 700; text-transform: uppercase; cursor: pointer; }
    .card-cat:active { transform: scale(1.05); }
    .card-cat.tasks { background: var(--cat-tasks-bg); color: var(--cat-tasks-text); }
    .card-cat.ideas { background: var(--cat-ideas-bg); color: var(--cat-ideas-text); }
    .card-cat.handmagic { background: var(--cat-handmagic-bg); color: var(--cat-handmagic-text); }
    .card-cat.design { background: var(--cat-design-bg); color: var(--cat-design-text); }
    .card-cat.bugs { background: var(--cat-bugs-bg); color: var(--cat-bugs-text); }
    .card-cat.questions { background: var(--cat-questions-bg); color: var(--cat-questions-text); }
    .card-cat.inbox { background: var(--cat-inbox-bg); color: var(--cat-inbox-text); }
    .card-meta { display: flex; align-items: center; gap: 12px; font-size: 0.7rem; color: var(--color-text-muted); font-weight: 500; }
    .card-text { font-size: 1rem; line-height: 1.4; color: var(--color-text); margin-bottom: 4px; padding: 0 6px; }
    .card-edit { display: none; margin-bottom: 10px; }
    .card.editing .card-text { display: none; }
    .card.editing .card-edit { display: block; }
    .card-ta { width: 100%; min-height: 70px; padding: 10px; border: 2px solid var(--color-border); border-radius: var(--radius-md); font-family: var(--font-main); font-size: 1rem; line-height: 1.4; color: var(--color-text); resize: vertical; }
    .card-ta:focus { outline: none; border-color: var(--color-primary); }
    
    .card-actions { display: none; gap: 6px; flex-wrap: wrap; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--color-border); animation: fadeIn 0.2s ease; }
    .card.active .card-actions { display: flex; }
    .card.editing .card-actions { display: none; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }
    .card-edit-actions { display: none; gap: 6px; margin-top: 10px; }
    .card.editing .card-edit-actions { display: flex; }
    .act { height: 34px; padding: 0 12px; border: none; background: var(--color-bg-soft); border-radius: var(--radius-full); font-family: var(--font-main); font-size: 0.7rem; font-weight: 600; color: var(--color-text-soft); cursor: pointer; text-transform: uppercase; display: flex; align-items: center; gap: 4px; }
    .act:active { transform: scale(0.97); background: var(--color-border); }
    .act.primary { background: var(--color-primary); color: white; }
    .act.secondary { background: var(--color-bg-soft); color: var(--color-text-soft); }

    .empty { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 30px; }
    .empty-icon { width: 72px; height: 72px; background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light)); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; margin-bottom: 16px; box-shadow: 0 4px 16px rgba(255,107,74,0.3); }
    .empty-icon svg { width: 36px; height: 36px; }
    .empty-title { font-size: 1rem; font-weight: 700; margin-bottom: 4px; }
    .empty-text { font-size: 0.8rem; color: var(--color-text-soft); }

    .rec-section { padding: 10px 14px calc(14px + var(--safe-bottom)); background: var(--color-bg-card); border-top: 1px solid var(--color-border); }
    .rec-status { display: none; align-items: center; justify-content: center; gap: 6px; padding: 8px; margin-bottom: 8px; background: rgba(239,68,68,0.1); border-radius: var(--radius-full); color: var(--color-recording); font-size: 0.75rem; font-weight: 600; }
    .rec-status.show { display: flex; }
    .rec-dot { width: 8px; height: 8px; background: var(--color-recording); border-radius: 50%; animation: blink 1s ease infinite; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .rec-btn { width: 100%; height: 52px; border: none; background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light)); border-radius: var(--radius-full); font-family: var(--font-main); font-size: 0.875rem; font-weight: 700; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: var(--shadow-md); text-transform: uppercase; letter-spacing: 0.03em; }
    .rec-btn:active { transform: scale(0.98); }
    .rec-btn.recording { background: var(--color-recording); animation: pulse 1.5s ease infinite; }
    @keyframes pulse { 0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,0.4)} 50%{box-shadow:0 0 0 10px rgba(239,68,68,0)} }
    .mic { width: 22px; height: 22px; }

    .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; padding: 16px; z-index: 100; backdrop-filter: blur(4px); }
    .overlay.show { display: flex; }
    .modal { width: 100%; max-width: 320px; background: var(--color-bg-card); border-radius: 16px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); animation: modalIn 0.2s ease; }
    @keyframes modalIn { from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:scale(1)} }
    .modal-title { font-size: 1rem; font-weight: 700; margin-bottom: 14px; text-align: center; }
    .modal-text { font-size: 0.8rem; color: var(--color-text-soft); margin-bottom: 16px; line-height: 1.5; }
    .modal-actions { display: flex; gap: 8px; justify-content: center; }
    .modal-btn { padding: 10px 20px; border: none; border-radius: var(--radius-full); font-family: var(--font-main); font-size: 0.75rem; font-weight: 600; cursor: pointer; text-transform: uppercase; }
    .modal-btn:active { transform: scale(0.97); }
    .modal-btn.sec { background: var(--color-bg-soft); color: var(--color-text); }
    .modal-btn.pri { background: var(--color-primary); color: white; }
    .modal-btn.danger { background: var(--color-error); color: white; }

    .cat-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 16px; }
    .cat-opt { padding: 10px 14px; border: none; border-radius: var(--radius-full); font-family: var(--font-main); font-size: 0.7rem; font-weight: 700; cursor: pointer; text-transform: uppercase; }
    .cat-opt:active { transform: scale(1.05); }
    .cat-opt[data-cat="tasks"] { background: var(--cat-tasks-bg); color: var(--cat-tasks-text); }
    .cat-opt[data-cat="ideas"] { background: var(--cat-ideas-bg); color: var(--cat-ideas-text); }
    .cat-opt[data-cat="handmagic"] { background: var(--cat-handmagic-bg); color: var(--cat-handmagic-text); }
    .cat-opt[data-cat="design"] { background: var(--cat-design-bg); color: var(--cat-design-text); }
    .cat-opt[data-cat="bugs"] { background: var(--cat-bugs-bg); color: var(--cat-bugs-text); }
    .cat-opt[data-cat="questions"] { background: var(--cat-questions-bg); color: var(--cat-questions-text); }
    .cat-opt[data-cat="inbox"] { background: var(--cat-inbox-bg); color: var(--cat-inbox-text); }

    .send-opts { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
    .send-opt { display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: var(--color-bg-soft); border: 1px solid var(--color-border); border-radius: var(--radius-md); cursor: pointer; }
    .send-opt:active { background: var(--color-bg); border-color: var(--color-primary); }
    .send-icon { width: 32px; height: 32px; background: var(--color-bg-card); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; font-size: 1rem; }
    .send-info { flex: 1; }
    .send-title { font-size: 0.8rem; font-weight: 600; }
    .send-desc { font-size: 0.7rem; color: var(--color-text-muted); }
    .send-badge { font-size: 0.55rem; font-weight: 700; padding: 3px 6px; background: linear-gradient(135deg,#6366F1,#8B5CF6); color: white; border-radius: var(--radius-full); text-transform: uppercase; }
    .send-div { display: flex; align-items: center; gap: 8px; margin: 4px 0; font-size: 0.6rem; color: var(--color-text-muted); text-transform: uppercase; font-weight: 600; }
    .send-div::before, .send-div::after { content: ''; flex: 1; height: 1px; background: var(--color-border); }

    .export-box { background: var(--color-bg-soft); border-radius: var(--radius-md); padding: 12px; font-family: monospace; font-size: 0.65rem; max-height: 180px; overflow-y: auto; white-space: pre-wrap; word-break: break-word; margin-bottom: 14px; border: 1px solid var(--color-border); }

    .about-brand { text-align: center; padding: 16px 0; margin-bottom: 14px; border-bottom: 1px solid var(--color-border); }
    .about-logo { width: 64px; height: 64px; background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light)); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; box-shadow: 0 4px 16px rgba(255,107,74,0.3); }
    .about-logo svg { width: 32px; height: 32px; }
    .about-name { font-size: 1.25rem; font-weight: 800; }
    .about-ver { font-size: 0.7rem; color: var(--color-text-muted); margin-top: 4px; }

    .toast-wrap { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); z-index: 200; pointer-events: none; }
    .toast { padding: 10px 16px; border-radius: var(--radius-full); font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); opacity: 0; transform: translateY(16px); transition: all 0.3s; pointer-events: auto; }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.success { background: var(--color-success); color: white; }
    .toast.warning { background: var(--color-warning); color: white; }
    .toast.error { background: var(--color-error); color: white; }
    .toast.info { background: var(--color-text); color: white; }

    @media (min-width:481px) { .app { margin: 20px auto; height: calc(100vh - 40px); border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.12); border: 1px solid var(--color-border); overflow: hidden; } }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <button class="logo-btn" onclick="openAbout()">
        <svg viewBox="0 0 24 24" fill="white"><path d="M12 2C12 2 5 10.5 5 15C5 18.866 8.134 22 12 22C15.866 22 19 18.866 19 15C19 10.5 12 2 12 2Z"/></svg>
      </button>
      <div class="slogan"><span class="slogan-hl">Just tap</span> to keep your idea</div>
      <button class="btn-icon" onclick="openSettings()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></button>
    </header>
    <div class="network-banner" id="netBanner">No internet</div>
    <div class="warning" id="warning">Speech recognition not supported. Use Chrome.</div>
    <div class="filters">
      <div class="time-row" id="timeRow">
        <button class="time-btn" data-time="all">All <span class="cnt" id="cntAll">0</span></button>
        <button class="time-btn" data-time="today">Today <span class="cnt" id="cntToday">0</span></button>
        <button class="time-btn" data-time="7days">7d <span class="cnt" id="cnt7d">0</span></button>
        <button class="sort-btn" id="sortBtn" onclick="toggleSort()" title="Sort order">‚Üë</button>
      </div>
      <div class="cat-row">
        <button class="cat-nav" onclick="scrollCats(-1)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="cats" id="cats">
          <button class="cat" data-category="tasks">Tasks <span class="cnt" id="cntTasks">0</span></button>
          <button class="cat" data-category="ideas">Ideas <span class="cnt" id="cntIdeas">0</span></button>
          <button class="cat" data-category="handmagic">Handmagic <span class="cnt" id="cntHandmagic">0</span></button>
          <button class="cat" data-category="design">Design <span class="cnt" id="cntDesign">0</span></button>
          <button class="cat" data-category="bugs">Bugs <span class="cnt" id="cntBugs">0</span></button>
          <button class="cat" data-category="questions">Questions <span class="cnt" id="cntQuestions">0</span></button>
          <button class="cat" data-category="inbox">Inbox <span class="cnt" id="cntInbox">0</span></button>
          <button class="cat-add" onclick="addCatPrompt()">+</button>
        </div>
        <button class="cat-nav" onclick="scrollCats(1)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg></button>
      </div>
    </div>
    <div class="ideas-wrap" id="ideasWrap">
      <button class="scroll-fab top" id="scrollTop" onclick="scrollToTop()">‚Üë</button>
      <div class="ideas" id="ideasList"></div>
      <div class="empty" id="emptyState">
        <div class="empty-icon"><svg viewBox="0 0 24 24" fill="white"><path d="M12 2C12 2 5 10.5 5 15C5 18.866 8.134 22 12 22C15.866 22 19 18.866 19 15C19 10.5 12 2 12 2Z"/></svg></div>
        <div class="empty-title">No ideas yet</div>
        <div class="empty-text">Tap below and speak</div>
      </div>
      <button class="scroll-fab bottom" id="scrollBottom" onclick="scrollToBottom()">‚Üì</button>
    </div>
    <div class="rec-section">
      <div class="rec-status" id="recStatus"><span class="rec-dot"></span><span id="recText">Listening...</span></div>
      <button class="rec-btn" id="recBtn" onclick="toggleRec()"><svg class="mic" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg><span id="recBtnText">Record Idea</span></button>
    </div>
  </div>
  <div class="toast-wrap" id="toastWrap"></div>

  <div class="overlay" id="aboutModal"><div class="modal"><div class="about-brand"><div class="about-logo"><svg viewBox="0 0 24 24" fill="white"><path d="M12 2C12 2 5 10.5 5 15C5 18.866 8.134 22 12 22C15.866 22 19 18.866 19 15C19 10.5 12 2 12 2Z"/></svg></div><div class="about-name">DropLit</div><div class="about-ver">v0.4.9 by Syntrise</div></div><div class="modal-text" style="text-align:center">Voice-first idea capture.<br>Tap card to see actions.</div><div class="modal-actions"><button class="modal-btn pri" onclick="closeAbout()">OK</button></div></div></div>
  <div class="overlay" id="catModal"><div class="modal"><div class="modal-title">üìÅ Move to</div><div class="cat-grid"><button class="cat-opt" data-cat="tasks" onclick="changeCat('tasks')">Tasks</button><button class="cat-opt" data-cat="ideas" onclick="changeCat('ideas')">Ideas</button><button class="cat-opt" data-cat="handmagic" onclick="changeCat('handmagic')">Handmagic</button><button class="cat-opt" data-cat="design" onclick="changeCat('design')">Design</button><button class="cat-opt" data-cat="bugs" onclick="changeCat('bugs')">Bugs</button><button class="cat-opt" data-cat="questions" onclick="changeCat('questions')">Questions</button><button class="cat-opt" data-cat="inbox" onclick="changeCat('inbox')">Inbox</button></div><div class="modal-actions"><button class="modal-btn sec" onclick="closeCatModal()">Cancel</button></div></div></div>
  <div class="overlay" id="sendModal"><div class="modal"><div class="modal-title">üì§ Send</div><div class="send-opts"><div class="send-opt" onclick="sendAI()"><div class="send-icon">ü§ñ</div><div class="send-info"><div class="send-title">AI Assistant</div><div class="send-desc">Copy + open Claude</div></div><span class="send-badge">Pro</span></div><div class="send-div">or share via</div><div class="send-opt" onclick="shareNative()"><div class="send-icon">üì±</div><div class="send-info"><div class="send-title">Share...</div><div class="send-desc">WhatsApp, Telegram</div></div></div><div class="send-opt" onclick="sendMail()"><div class="send-icon">‚úâÔ∏è</div><div class="send-info"><div class="send-title">Email</div><div class="send-desc">Send via email</div></div></div><div class="send-opt" onclick="copyClip()"><div class="send-icon">üìã</div><div class="send-info"><div class="send-title">Copy</div><div class="send-desc">Copy to clipboard</div></div></div></div><div class="modal-actions"><button class="modal-btn sec" onclick="closeSendModal()">Cancel</button></div></div></div>
  <div class="overlay" id="exportModal"><div class="modal"><div class="modal-title">üì• Export</div><div class="export-box" id="exportBox"></div><div class="modal-actions"><button class="modal-btn sec" onclick="closeExportModal()">Close</button><button class="modal-btn pri" onclick="copyExport()">Copy</button></div></div></div>
  <div class="overlay" id="delModal"><div class="modal"><div class="modal-title">üóëÔ∏è Delete?</div><div class="modal-text">This cannot be undone.</div><div class="modal-actions"><button class="modal-btn sec" onclick="closeDelModal()">Cancel</button><button class="modal-btn danger" onclick="confirmDel()">Delete</button></div></div></div>
  <div class="overlay" id="settingsModal"><div class="modal"><div class="modal-title">‚öôÔ∏è Settings</div><div class="modal-text">Coming soon:<br>‚Ä¢ Search üîç<br>‚Ä¢ Themes ‚Ä¢ Custom categories ‚Ä¢ Cloud sync</div><div class="modal-actions"><button class="modal-btn sec" onclick="exportAll()">üì• Export</button><button class="modal-btn pri" onclick="closeSettings()">OK</button></div></div></div>
  <div class="overlay" id="addCatModal"><div class="modal"><div class="modal-title">‚ûï Add Category</div><div class="modal-text">Custom categories coming soon!</div><div class="modal-actions"><button class="modal-btn pri" onclick="closeAddCatModal()">OK</button></div></div></div>

<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js').catch(()=>{});}
let ideas=JSON.parse(localStorage.getItem('droplit_ideas'))||[];
let curCat='all',curTime='all',sortAsc=true,isRec=false,recognition=null,saved=false;
let sendId=null,delId=null,catChangeId=null,editId=null,activeCardId=null;
let lastScrollTop=0,scrollDir=0;
const CATS={tasks:{name:'TASKS',kw:['–∑–∞–¥–∞—á–∞','—Å–¥–µ–ª–∞—Ç—å','–Ω—É–∂–Ω–æ','–Ω–∞–¥–æ','task','todo']},ideas:{name:'IDEAS',kw:['–∏–¥–µ—è','–º—ã—Å–ª—å','–ø—Ä–∏–¥—É–º–∞–ª','idea']},handmagic:{name:'HANDMAGIC',kw:['handmagic','—Ö–µ–Ω–¥–º–µ–¥–∂–∏–∫','–º–∞–≥–∏—è']},design:{name:'DESIGN',kw:['–¥–∏–∑–∞–π–Ω','ui','ux','–∫–Ω–æ–ø–∫–∞','—Ü–≤–µ—Ç','design']},bugs:{name:'BUGS',kw:['–±–∞–≥','–æ—à–∏–±–∫–∞','bug','fix']},questions:{name:'QUESTIONS',kw:['–≤–æ–ø—Ä–æ—Å','—Å–ø—Ä–æ—Å–∏—Ç—å','claude']},inbox:{name:'INBOX',kw:[]}};

function parseD(s){const[d,m,y]=s.split('.').map(Number);return new Date(y,m-1,d);}
function inDays(s,n){return(new Date()-parseD(s))/(864e5)<=n;}
function isToday(s){return s===new Date().toLocaleDateString('ru-RU');}

// Smart scroll FAB
const ideasWrap=document.getElementById('ideasWrap');
const scrollTopBtn=document.getElementById('scrollTop');
const scrollBottomBtn=document.getElementById('scrollBottom');
let scrollTimeout=null;

ideasWrap.addEventListener('scroll',()=>{
  const st=ideasWrap.scrollTop;
  const maxScroll=ideasWrap.scrollHeight-ideasWrap.clientHeight;
  scrollDir=st>lastScrollTop?1:-1;
  lastScrollTop=st;
  
  clearTimeout(scrollTimeout);
  scrollTopBtn.classList.remove('show');
  scrollBottomBtn.classList.remove('show');
  
  if(maxScroll>200){
    if(scrollDir<0 && st>150){
      scrollTopBtn.classList.add('show');
    } else if(scrollDir>0 && st<maxScroll-150){
      scrollBottomBtn.classList.add('show');
    }
  }
  
  scrollTimeout=setTimeout(()=>{
    scrollTopBtn.classList.remove('show');
    scrollBottomBtn.classList.remove('show');
  },2000);
});

function scrollToTop(){ideasWrap.scrollTo({top:0,behavior:'smooth'});scrollTopBtn.classList.remove('show');}
function scrollToBottom(){ideasWrap.scrollTo({top:ideasWrap.scrollHeight,behavior:'smooth'});scrollBottomBtn.classList.remove('show');}

function toggleSort(){
  sortAsc=!sortAsc;
  document.getElementById('sortBtn').textContent=sortAsc?'‚Üë':'‚Üì';
  document.getElementById('sortBtn').classList.toggle('desc',!sortAsc);
  render();
}

function activateCard(id,e){
  if(e&&(e.target.closest('.card-cat')||e.target.closest('.act')||e.target.closest('.card-ta')))return;
  if(activeCardId===id){activeCardId=null;}else{activeCardId=id;}
  render();
}

document.addEventListener('click',(e)=>{
  if(activeCardId&&!e.target.closest('.card')&&!e.target.closest('.overlay')){activeCardId=null;render();}
});

function initSR(){const SR=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SR){document.getElementById('warning').style.display='block';document.getElementById('recBtn').disabled=true;return false;}recognition=new SR();recognition.lang='ru-RU';recognition.continuous=false;recognition.interimResults=true;recognition.maxAlternatives=1;recognition.onstart=()=>{isRec=true;saved=false;updateRecUI(true);};recognition.onresult=(e)=>{let f='',i='';for(let x=0;x<e.results.length;x++){if(e.results[x].isFinal)f+=e.results[x][0].transcript;else i+=e.results[x][0].transcript;}document.getElementById('recText').textContent=(f||i)||'Listening...';if(f&&!saved){saved=true;saveIdea(f.trim());}};recognition.onerror=(e)=>{if(e.error==='no-speech')toast('No speech','warning');else if(e.error==='not-allowed')toast('Mic denied','error');isRec=false;updateRecUI(false);};recognition.onend=()=>{isRec=false;updateRecUI(false);};return true;}
function toggleRec(){if(isRec)recognition.stop();else{saved=false;recognition.start();}}
function updateRecUI(on){const btn=document.getElementById('recBtn'),txt=document.getElementById('recBtnText'),st=document.getElementById('recStatus');if(on){btn.classList.add('recording');txt.textContent='Stop';st.classList.add('show');document.getElementById('recText').textContent='Listening...';}else{btn.classList.remove('recording');txt.textContent='Record Idea';st.classList.remove('show');}}
function detectCat(t){const l=t.toLowerCase();for(const[k,v]of Object.entries(CATS)){if(k==='inbox')continue;for(const w of v.kw)if(l.startsWith(w)||l.includes(' '+w+' '))return k;}return'inbox';}
function saveIdea(t){const c=detectCat(t),idea={id:Date.now(),text:t,category:c,timestamp:new Date().toISOString(),date:new Date().toLocaleDateString('ru-RU'),time:new Date().toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'})};ideas.push(idea);save();curCat='all';curTime='all';activeCardId=null;document.querySelectorAll('.cat').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.time-btn').forEach(x=>x.classList.remove('active'));render();counts();setTimeout(()=>{scrollToBottom();},100);toast('Saved to '+CATS[c].name,'success');}
function openCatModal(id){catChangeId=id;document.getElementById('catModal').classList.add('show');}
function closeCatModal(){document.getElementById('catModal').classList.remove('show');catChangeId=null;}
function changeCat(c){if(catChangeId){const i=ideas.find(x=>x.id===catChangeId);if(i){i.category=c;save();render();counts();toast('Moved to '+CATS[c].name,'success');}}closeCatModal();}
function reqDel(id){delId=id;document.getElementById('delModal').classList.add('show');}
function closeDelModal(){document.getElementById('delModal').classList.remove('show');delId=null;}
function confirmDel(){if(delId){ideas=ideas.filter(x=>x.id!==delId);save();activeCardId=null;render();counts();toast('Deleted','info');}closeDelModal();}
function startEdit(id){if(editId)cancelEdit(editId);editId=id;activeCardId=id;render();setTimeout(()=>{const card=document.querySelector('[data-id="'+id+'"]');const ta=card?.querySelector('.card-ta');if(ta){card.scrollIntoView({behavior:'smooth',block:'center'});ta.focus();}},100);}
function saveEdit(id){const card=document.querySelector('[data-id="'+id+'"]'),ta=card?.querySelector('.card-ta');if(ta){const t=ta.value.trim();if(t){const i=ideas.find(x=>x.id===id);if(i){i.text=t;i.category=detectCat(t);save();toast('Saved','success');}}}editId=null;render();counts();}
function cancelEdit(id){editId=null;render();}
function openSendModal(id){sendId=id;document.getElementById('sendModal').classList.add('show');}
function closeSendModal(){document.getElementById('sendModal').classList.remove('show');sendId=null;}
function sendAI(){const i=ideas.find(x=>x.id===sendId);if(i){navigator.clipboard.writeText(i.text);window.open('https://claude.ai','_blank');toast('Copied!','success');}closeSendModal();}
function shareNative(){const i=ideas.find(x=>x.id===sendId);if(i&&navigator.share)navigator.share({title:'DropLit',text:i.text}).catch(()=>{});else if(i){navigator.clipboard.writeText(i.text);toast('Copied','success');}closeSendModal();}
function sendMail(){const i=ideas.find(x=>x.id===sendId);if(i)window.open('mailto:?subject='+encodeURIComponent('DropLit: '+CATS[i.category].name)+'&body='+encodeURIComponent(i.text));closeSendModal();}
function copyClip(){const i=ideas.find(x=>x.id===sendId);if(i){navigator.clipboard.writeText(i.text);toast('Copied','success');}closeSendModal();}
function copyIdea(id){const i=ideas.find(x=>x.id===id);if(i){navigator.clipboard.writeText(i.text);toast('Copied','success');}}
function save(){localStorage.setItem('droplit_ideas',JSON.stringify(ideas));}
function smartTime(i){const td=new Date().toLocaleDateString('ru-RU'),yd=new Date(Date.now()-864e5).toLocaleDateString('ru-RU');if(i.date===td)return i.time;if(i.date===yd)return'Yesterday, '+i.time;const p=i.date.split('.');return p[0]+'.'+p[1]+', '+i.time;}
function filtered(){let f=[...ideas];if(curTime==='today')f=f.filter(x=>isToday(x.date));else if(curTime==='7days')f=f.filter(x=>inDays(x.date,7));if(curCat!=='all')f=f.filter(x=>x.category===curCat);return f;}
function render(){const wrap=document.getElementById('ideasList'),empty=document.getElementById('emptyState'),list=filtered();if(!list.length){wrap.innerHTML='';empty.style.display='flex';return;}empty.style.display='none';const grp={};for(const i of list){if(!grp[i.date])grp[i.date]=[];grp[i.date].push(i);}
let dates=Object.keys(grp).sort((a,b)=>sortAsc?parseD(a)-parseD(b):parseD(b)-parseD(a));
let h='';const td=new Date().toLocaleDateString('ru-RU'),yd=new Date(Date.now()-864e5).toLocaleDateString('ru-RU');
for(const d of dates){let lbl=d;if(d===td)lbl='Today';else if(d===yd)lbl='Yesterday';h+='<div class="date-sep">'+lbl+'</div>';
let dayIdeas=grp[d];if(!sortAsc)dayIdeas=dayIdeas.slice().reverse();
for(const i of dayIdeas){const isActive=activeCardId===i.id;const isEditing=editId===i.id;const cc=i.text.length;
h+='<div class="card'+(isActive?' active':'')+(isEditing?' editing':'')+'" data-id="'+i.id+'" onclick="activateCard('+i.id+',event)"><div class="card-head"><span class="card-cat '+i.category+'" onclick="openCatModal('+i.id+')">'+CATS[i.category].name+'</span><div class="card-meta"><span>'+cc+'</span><span>'+smartTime(i)+'</span></div></div><div class="card-text">'+esc(i.text)+'</div><div class="card-edit"><textarea class="card-ta">'+esc(i.text)+'</textarea></div><div class="card-actions"><button class="act" onclick="startEdit('+i.id+')">‚úèÔ∏è Edit</button><button class="act" onclick="openSendModal('+i.id+')">üì§ Send</button><button class="act" onclick="copyIdea('+i.id+')">üìã Copy</button><button class="act" onclick="reqDel('+i.id+')">üóëÔ∏è Delete</button></div><div class="card-edit-actions"><button class="act primary" onclick="saveEdit('+i.id+')">Save</button><button class="act secondary" onclick="cancelEdit('+i.id+')">Cancel</button></div></div>';}}wrap.innerHTML=h;}
function esc(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML;}
function counts(){document.getElementById('cntAll').textContent=ideas.length;document.getElementById('cntToday').textContent=ideas.filter(x=>isToday(x.date)).length;document.getElementById('cnt7d').textContent=ideas.filter(x=>inDays(x.date,7)).length;let tf=[...ideas];if(curTime==='today')tf=tf.filter(x=>isToday(x.date));else if(curTime==='7days')tf=tf.filter(x=>inDays(x.date,7));for(const k of Object.keys(CATS)){const el=document.getElementById('cnt'+k.charAt(0).toUpperCase()+k.slice(1));if(el)el.textContent=tf.filter(x=>x.category===k).length;}}
document.getElementById('timeRow').addEventListener('click',e=>{const b=e.target.closest('.time-btn');if(!b)return;document.querySelectorAll('.time-btn').forEach(x=>x.classList.remove('active'));if(b.dataset.time!=='all')b.classList.add('active');curTime=b.dataset.time;curCat='all';activeCardId=null;document.querySelectorAll('.cat').forEach(x=>x.classList.remove('active'));render();counts();});
document.getElementById('cats').addEventListener('click',e=>{const c=e.target.closest('.cat');if(!c)return;if(c.classList.contains('active')){c.classList.remove('active');curCat='all';}else{document.querySelectorAll('.cat').forEach(x=>x.classList.remove('active'));c.classList.add('active');curCat=c.dataset.category;}activeCardId=null;render();});
function scrollCats(d){document.getElementById('cats').scrollBy({left:d*100,behavior:'smooth'});}
function addCatPrompt(){document.getElementById('addCatModal').classList.add('show');}
function closeAddCatModal(){document.getElementById('addCatModal').classList.remove('show');}
function exportAll(){closeSettings();if(!ideas.length){toast('Nothing to export','warning');return;}const grp={};for(const i of ideas){if(!grp[i.category])grp[i.category]=[];grp[i.category].push(i);}let md='# DropLit Export\n'+new Date().toLocaleDateString('ru-RU')+' | Total: '+ideas.length+'\n\n';for(const[k,arr]of Object.entries(grp)){md+='## '+CATS[k].name+' ('+arr.length+')\n';for(const i of arr)md+='- ['+i.date+' '+i.time+'] '+i.text+'\n';md+='\n';}md+='---\nDropLit v0.4.9 by Syntrise';document.getElementById('exportBox').textContent=md;document.getElementById('exportModal').classList.add('show');}
function closeExportModal(){document.getElementById('exportModal').classList.remove('show');}
function copyExport(){navigator.clipboard.writeText(document.getElementById('exportBox').textContent);toast('Copied!','success');closeExportModal();}
function openAbout(){document.getElementById('aboutModal').classList.add('show');}
function closeAbout(){document.getElementById('aboutModal').classList.remove('show');}
function openSettings(){document.getElementById('settingsModal').classList.add('show');}
function closeSettings(){document.getElementById('settingsModal').classList.remove('show');}
function toast(m,t='info'){const w=document.getElementById('toastWrap'),el=document.createElement('div');el.className='toast '+t;el.innerHTML=({success:'‚úì',warning:'‚ö†',error:'‚úñ',info:'‚Ñπ'})[t]+' '+m;w.appendChild(el);setTimeout(()=>el.classList.add('show'),10);setTimeout(()=>{el.classList.remove('show');setTimeout(()=>el.remove(),300);},2500);}
function updateNet(){document.getElementById('netBanner').classList.toggle('show',!navigator.onLine);}
window.addEventListener('online',updateNet);window.addEventListener('offline',updateNet);
document.addEventListener('DOMContentLoaded',()=>{initSR();render();counts();updateNet();setTimeout(()=>{scrollToBottom();},100);});
</script>
</body>
</html>
